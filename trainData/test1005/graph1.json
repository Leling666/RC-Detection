[{"cfgs": [1], "code": "Header[] lowercaseHeaders = LOWERCASE_KEYS.apply(headers)", "dfgs": [1], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [2], "isDel": true, "lineBeg": 73, "lineEnd": 73, "lineMapIndex": 19, "methodParents": [3], "nodeIndex": 0, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "Map<String, List<String>> combinedHeaders = COMBINE_HEADERS.apply(lowercaseHeaders)", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": true, "lineBeg": 74, "lineEnd": 74, "lineMapIndex": 20, "methodParents": [3], "nodeIndex": 1, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "private static Function<Header[], Header[]> LOWERCASE_KEYS = new Function<Header[], Header[]>() {@Overridepublic Header[] apply(Header[] headers) {Header[] lowercaseHeaders = new Header[headers.length];for (int i = 0; i < headers.length; i++) {lowercaseHeaders[i] = new BasicHeader(headers[i].getName().toLowerCase(), headers[i].getValue());}return lowercaseHeaders;}}", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": true, "lineBeg": 169, "lineEnd": 179, "lineMapIndex": 21, "methodParents": [], "nodeIndex": 2, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "Header[] lowercaseHeaders = new Header[headers.length]", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": true, "lineBeg": 172, "lineEnd": 172, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 3, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "lowercaseHeaders[i] = new BasicHeader(headers[i].getName().toLowerCase(), headers[i].getValue())", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": true, "lineBeg": 174, "lineEnd": 174, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 4, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "return lowercaseHeaders", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": true, "lineBeg": 177, "lineEnd": 177, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 5, "rootcause": false, "commits": ["0b98ed1f5ae023b645e1b3197ed65152037fb866"]}, {"cfgs": [], "code": "public void testCreateCanonicalRequestWithHostPort() throws Exception ", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_RequestCanonicalizerTest.java", "fieldParents": [], "isDel": false, "lineBeg": 55, "lineEnd": 55, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 6, "rootcause": false, "commits": []}, {"cfgs": [8], "code": "String queryParams = \"PageSize=5&Limit=10\"", "dfgs": [9], "fName": "src_test_java_com_twilio_jwt_validation_RequestCanonicalizerTest.java", "fieldParents": [], "isDel": false, "lineBeg": 56, "lineEnd": 56, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 7, "rootcause": false, "commits": []}, {"cfgs": [9], "code": "headers[0] = new BasicHeader(\"host\", \"api.twilio.com:443\")", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_RequestCanonicalizerTest.java", "fieldParents": [], "isDel": false, "lineBeg": 57, "lineEnd": 57, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 8, "rootcause": false, "commits": []}, {"cfgs": [10], "code": "String canonicalRequest = canonicalizeWithQueryParams(queryParams)", "dfgs": [10], "fName": "src_test_java_com_twilio_jwt_validation_RequestCanonicalizerTest.java", "fieldParents": [], "isDel": false, "lineBeg": 59, "lineEnd": 59, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 9, "rootcause": false, "commits": []}, {"cfgs": [], "code": "Assert.assertEquals(\"GET\\n\" + // action\"/Messages\\n\" + // path\"Limit=10&PageSize=5\\n\" + //queryParams\"authorization:foobar\\n\" + // included header #1\"duplicate:value1,value2\\n\" + // included header #2\"host:api.twilio.com\\n\" + // included headar #3\"\\n\" + // empty line after headers\"authorization;duplicate;host\\n\" + // included headers\"c3ab8ff13720e8ad9047dd39466b3c8974e592c2fa383d4a3960714caef0c4f2\", // body hashcanonicalRequest)", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_RequestCanonicalizerTest.java", "fieldParents": [], "isDel": false, "lineBeg": 61, "lineEnd": 70, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 10, "rootcause": false, "commits": []}, {"cfgs": [], "code": "public void testTokenFromHttpRequestWithHostPort() throws IOException ", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 136, "lineEnd": 136, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 11, "rootcause": false, "commits": []}, {"cfgs": [13], "code": "headers[0] = new BasicHeader(\"host\", \"api.twilio.com:443\")", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 137, "lineEnd": 137, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 12, "rootcause": false, "commits": []}, {"cfgs": [14], "code": "new Expectations() {{request.getRequestLine().getMethod();result = \"GET\";request.getRequestLine().getUri();result = \"/Messages?PageSize=5&Limit=10\";request.getAllHeaders();result = headers;}}", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 138, "lineEnd": 147, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 13, "rootcause": false, "commits": []}, {"cfgs": [15], "code": "Jwt jwt = ValidationToken.fromHttpRequest(ACCOUNT_SID, CREDENTIAL_SID, SIGNING_KEY_SID, privateKey, request, SIGNED_HEADERS)", "dfgs": [16, 15], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 149, "lineEnd": 149, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 14, "rootcause": false, "commits": []}, {"cfgs": [16], "code": "Claims claims =Jwts.parser().setSigningKey(privateKey).parseClaimsJws(jwt.toJwt()).getBody()", "dfgs": [16], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 150, "lineEnd": 154, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 15, "rootcause": false, "commits": []}, {"cfgs": [17], "code": "this.validateToken(claims)", "dfgs": [17], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 157, "lineEnd": 157, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 16, "rootcause": false, "commits": []}, {"cfgs": [18], "code": "Assert.assertEquals(\"authorization;host\", claims.get(\"hrh\"))", "dfgs": [18], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 158, "lineEnd": 158, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 17, "rootcause": false, "commits": []}, {"cfgs": [], "code": "Assert.assertEquals(\"4b3d2666845a38f00259a5231a08765bb2d12564bc4469fd5b2816204c588967\", claims.get(\"rqh\"))", "dfgs": [], "fName": "src_test_java_com_twilio_jwt_validation_ValidationTokenTest.java", "fieldParents": [], "isDel": false, "lineBeg": 159, "lineEnd": 159, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 18, "rootcause": false, "commits": []}, {"cfgs": [20], "code": "Header[] normalizedHeaders = NORMALIZE_HEADERS.apply(headers)", "dfgs": [20], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [21], "isDel": false, "lineBeg": 73, "lineEnd": 73, "lineMapIndex": 0, "methodParents": [], "nodeIndex": 19, "rootcause": false, "commits": []}, {"cfgs": [], "code": "Map<String, List<String>> combinedHeaders = COMBINE_HEADERS.apply(normalizedHeaders)", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": false, "lineBeg": 74, "lineEnd": 74, "lineMapIndex": 1, "methodParents": [], "nodeIndex": 20, "rootcause": false, "commits": []}, {"cfgs": [], "code": "private static Function<Header[], Header[]> NORMALIZE_HEADERS = new Function<Header[], Header[]>() {@Overridepublic Header[] apply(Header[] headers) {Header[] normalizedHeaders = new Header[headers.length];for (int i = 0; i < headers.length; i++) {String headerName = headers[i].getName().toLowerCase();String headerValue = headers[i].getValue();if (headerName.equals(\"host\") && (headerValue.endsWith(\":443\") || headerValue.endsWith(\":80\"))) {headerValue = headerValue.split(\":\")[0];}normalizedHeaders[i] = new BasicHeader(headerName, headerValue);}return normalizedHeaders;}}", "dfgs": [], "fName": "src_main_java_com_twilio_jwt_validation_RequestCanonicalizer.java", "fieldParents": [], "isDel": false, "lineBeg": 172, "lineEnd": 189, "lineMapIndex": 2, "methodParents": [], "nodeIndex": 21, "rootcause": false, "commits": []}]