[{"cfgs":[1],"code":"if (paramName.equals(CSP_NONCE_VARIABLE_NAME))","dfgs":[1],"fName":"java_src_com_google_template_soy_jssrc_internal_TranslateExprNodeVisitor.java","fieldParents":[],"isDel":true,"lineBeg":206,"lineEnd":206,"lineMapIndex":26,"methodParents":[],"nodeIndex":0},{"cfgs":[],"code":"return OPT_IJ_DATA.and(OPT_IJ_DATA.dotAccess(paramName), codeGenerator)","dfgs":[],"fName":"java_src_com_google_template_soy_jssrc_internal_TranslateExprNodeVisitor.java","fieldParents":[],"isDel":true,"lineBeg":207,"lineEnd":207,"lineMapIndex":27,"methodParents":[],"nodeIndex":1},{"cfgs":[],"code":"private static final String NONCE =\"{if $csp_nonce} nonce=\\\"{$csp_nonce |escapeHtmlAttribute}\\\"{/if}\"","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPassTest.java","fieldParents":[],"isDel":true,"lineBeg":34,"lineEnd":35,"lineMapIndex":28,"methodParents":[],"nodeIndex":2},{"cfgs":[],"code":"assertThat(names(manager.singleFilePasses)).containsExactly(\"ContentSecurityPolicyNonceInjection\", \"ResolveTemplateParamTypes\")","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_PassManagerTest.java","fieldParents":[],"isDel":true,"lineBeg":70,"lineEnd":71,"lineMapIndex":29,"methodParents":[],"nodeIndex":3},{"cfgs":[],"code":"assertThat(names(manager.singleFilePasses)).containsExactly(\"ContentSecurityPolicyNonceInjection\")","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_PassManagerTest.java","fieldParents":[],"isDel":true,"lineBeg":83,"lineEnd":84,"lineMapIndex":30,"methodParents":[],"nodeIndex":4},{"cfgs":[],"code":"import com.google.template.soy.types.ast.NamedTypeNode","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":38,"lineEnd":38,"lineMapIndex":32,"methodParents":[],"nodeIndex":5},{"cfgs":[7],"code":"for (TemplateNode template : file.getChildren())","dfgs":[9],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":110,"lineEnd":110,"lineMapIndex":-1,"methodParents":[],"nodeIndex":6},{"cfgs":[8],"code":"boolean injected = false","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":111,"lineEnd":111,"lineMapIndex":-1,"methodParents":[],"nodeIndex":7},{"cfgs":[9],"code":"TemplateParam defn =new TemplateParam(CSP_NONCE_VARIABLE_NAME,SourceLocation.UNKNOWN,// We don't use string because the targets don't have the dependency on// goog.soy.data.UnsanitizedText.NamedTypeNode.create(SourceLocation.UNKNOWN, \"any\"),/* isRequired= */ false,/* isInjected= */ true,/* desc= */ \"Created by ContentSecurityPolicyNonceInjectionPass.\",/* defaultValue= */ null)","dfgs":[15,12],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":112,"lineEnd":122,"lineMapIndex":-1,"methodParents":[],"nodeIndex":8},{"cfgs":[10,14],"code":"for (HtmlOpenTagNode openTag :SoyTreeUtils.getAllNodesOfType(template, HtmlOpenTagNode.class))","dfgs":[15,10],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":123,"lineEnd":124,"lineMapIndex":34,"methodParents":[],"nodeIndex":9},{"cfgs":[11],"code":"if (isTagNonceable(openTag))","dfgs":[12,11],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":125,"lineEnd":125,"lineMapIndex":35,"methodParents":[],"nodeIndex":10},{"cfgs":[12],"code":"SourceLocation insertionLocation =openTag.getSourceLocation().getEndPoint().offset(0, openTag.isSelfClosing() ? -2 : -1).asLocation(openTag.getSourceLocation().getFilePath())","dfgs":[12],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":128,"lineEnd":133,"lineMapIndex":36,"methodParents":[],"nodeIndex":11},{"cfgs":[13],"code":"openTag.addChild(createCspInjection(insertionLocation, nodeIdGen, defn))","dfgs":[15],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":134,"lineEnd":134,"lineMapIndex":37,"methodParents":[16],"nodeIndex":12},{"cfgs":[],"code":"injected = true","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":135,"lineEnd":135,"lineMapIndex":-1,"methodParents":[],"nodeIndex":13},{"cfgs":[15],"code":"if (injected)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":138,"lineEnd":138,"lineMapIndex":-1,"methodParents":[],"nodeIndex":14},{"cfgs":[],"code":"template.addCspNonceParam(defn)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":139,"lineEnd":139,"lineMapIndex":-1,"methodParents":[22],"nodeIndex":15},{"cfgs":[17],"code":"private static IfNode createCspInjection(SourceLocation insertionLocation, IdGenerator nodeIdGen, TemplateParam defn)","dfgs":[18,17],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":191,"lineEnd":192,"lineMapIndex":38,"methodParents":[],"nodeIndex":16},{"cfgs":[18],"code":"IfCondNode ifCondNode =new IfCondNode(nodeIdGen.genId(), insertionLocation, \"if\", referenceCspNonce(insertionLocation, defn))","dfgs":[18],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":194,"lineEnd":196,"lineMapIndex":39,"methodParents":[],"nodeIndex":17},{"cfgs":[],"code":"PrintNode printNode =new PrintNode(nodeIdGen.genId(),insertionLocation,/* isImplicit= */ true, // Implicit.  {$csp_nonce} not {print $csp_nonce}referenceCspNonce(insertionLocation, defn),/* attributes= */ ImmutableList.of(),ErrorReporter.exploding())","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":210,"lineEnd":217,"lineMapIndex":40,"methodParents":[],"nodeIndex":18},{"cfgs":[20],"code":"private static VarRefNode referenceCspNonce(SourceLocation insertionLocation, TemplateParam defn)","dfgs":[20],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":222,"lineEnd":223,"lineMapIndex":41,"methodParents":[],"nodeIndex":19},{"cfgs":[],"code":"return new VarRefNode(CSP_NONCE_VARIABLE_NAME, insertionLocation, /* isDollarSignIjParameter= */ false, defn)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":true,"lineBeg":224,"lineEnd":225,"lineMapIndex":42,"methodParents":[],"nodeIndex":20},{"cfgs":[],"code":"private ImmutableList<TemplateParam> injectedParams","dfgs":[],"fName":"java_src_com_google_template_soy_soytree_TemplateNode.java","fieldParents":[],"isDel":true,"lineBeg":234,"lineEnd":234,"lineMapIndex":43,"methodParents":[],"nodeIndex":21},{"cfgs":[23],"code":"public void addCspNonceParam(TemplateParam cspNonce) ","dfgs":[23],"fName":"java_src_com_google_template_soy_soytree_TemplateNode.java","fieldParents":[],"isDel":true,"lineBeg":492,"lineEnd":492,"lineMapIndex":-1,"methodParents":[],"nodeIndex":22},{"cfgs":[],"code":"injectedParams =ImmutableList.<TemplateParam>builder().addAll(injectedParams).add(cspNonce).build()","dfgs":[],"fName":"java_src_com_google_template_soy_soytree_TemplateNode.java","fieldParents":[21],"isDel":true,"lineBeg":493,"lineEnd":494,"lineMapIndex":-1,"methodParents":[],"nodeIndex":23},{"cfgs":[],"code":"private static final String NONCE =\"{if $csp_nonce} nonce=\\\"{$csp_nonce |escapeHtmlAttribute}\\\"{/if}\"","dfgs":[],"fName":"java_tests_com_google_template_soy_parsepasses_contextautoesc_ContextualAutoescaperTest.java","fieldParents":[],"isDel":true,"lineBeg":2560,"lineEnd":2561,"lineMapIndex":44,"methodParents":[],"nodeIndex":24},{"cfgs":[],"code":"addPass(new ContentSecurityPolicyNonceInjectionPass(errorReporter), singleFilePassesBuilder)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_PassManager.java","fieldParents":[],"isDel":true,"lineBeg":260,"lineEnd":260,"lineMapIndex":45,"methodParents":[],"nodeIndex":25},{"cfgs":[27],"code":"if (node.getName().equals(CSP_NONCE_VARIABLE_NAME))","dfgs":[27],"fName":"java_src_com_google_template_soy_jssrc_internal_TranslateExprNodeVisitor.java","fieldParents":[],"isDel":false,"lineBeg":324,"lineEnd":324,"lineMapIndex":0,"methodParents":[],"nodeIndex":26},{"cfgs":[],"code":"return OPT_IJ_DATA.and(OPT_IJ_DATA.dotAccess(node.getName()), codeGenerator)","dfgs":[],"fName":"java_src_com_google_template_soy_jssrc_internal_TranslateExprNodeVisitor.java","fieldParents":[],"isDel":false,"lineBeg":325,"lineEnd":325,"lineMapIndex":1,"methodParents":[],"nodeIndex":27},{"cfgs":[],"code":"private static final String NONCE =\"{if $ij.csp_nonce} nonce=\\\"{$ij.csp_nonce |escapeHtmlAttribute}\\\"{/if}\"","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPassTest.java","fieldParents":[],"isDel":false,"lineBeg":34,"lineEnd":35,"lineMapIndex":2,"methodParents":[],"nodeIndex":28},{"cfgs":[],"code":"assertThat(names(manager.singleFilePasses)).containsExactly(\"ResolveTemplateParamTypes\")","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_PassManagerTest.java","fieldParents":[],"isDel":false,"lineBeg":70,"lineEnd":70,"lineMapIndex":3,"methodParents":[],"nodeIndex":29},{"cfgs":[],"code":"assertThat(names(manager.singleFilePasses)).isEmpty()","dfgs":[],"fName":"java_tests_com_google_template_soy_passes_PassManagerTest.java","fieldParents":[],"isDel":false,"lineBeg":82,"lineEnd":82,"lineMapIndex":4,"methodParents":[],"nodeIndex":30},{"cfgs":[],"code":"import com.google.template.soy.soytree.defn.InjectedParam","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":37,"lineEnd":37,"lineMapIndex":-1,"methodParents":[],"nodeIndex":31},{"cfgs":[],"code":"import com.google.template.soy.types.AnyType","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":39,"lineEnd":39,"lineMapIndex":5,"methodParents":[],"nodeIndex":32},{"cfgs":[],"code":"public static final InjectedParam DEFN =new InjectedParam(CSP_NONCE_VARIABLE_NAME, SourceLocation.UNKNOWN, AnyType.getInstance())","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":79,"lineEnd":80,"lineMapIndex":-1,"methodParents":[],"nodeIndex":33},{"cfgs":[35],"code":"for (HtmlOpenTagNode openTag : SoyTreeUtils.getAllNodesOfType(file, HtmlOpenTagNode.class))","dfgs":[35],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":113,"lineEnd":113,"lineMapIndex":9,"methodParents":[],"nodeIndex":34},{"cfgs":[36],"code":"if (isTagNonceable(openTag))","dfgs":[37,36],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":114,"lineEnd":114,"lineMapIndex":10,"methodParents":[],"nodeIndex":35},{"cfgs":[37],"code":"SourceLocation insertionLocation =openTag.getSourceLocation().getEndPoint().offset(0, openTag.isSelfClosing() ? -2 : -1).asLocation(openTag.getSourceLocation().getFilePath())","dfgs":[37],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":117,"lineEnd":122,"lineMapIndex":11,"methodParents":[],"nodeIndex":36},{"cfgs":[],"code":"openTag.addChild(createCspInjection(insertionLocation, nodeIdGen))","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":123,"lineEnd":123,"lineMapIndex":12,"methodParents":[38],"nodeIndex":37},{"cfgs":[39],"code":"private static IfNode createCspInjection(SourceLocation insertionLocation, IdGenerator nodeIdGen)","dfgs":[40,39],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":175,"lineEnd":176,"lineMapIndex":16,"methodParents":[],"nodeIndex":38},{"cfgs":[40],"code":"IfCondNode ifCondNode =new IfCondNode(nodeIdGen.genId(), insertionLocation, \"if\", referenceCspNonce(insertionLocation))","dfgs":[40],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":178,"lineEnd":180,"lineMapIndex":17,"methodParents":[],"nodeIndex":39},{"cfgs":[],"code":"PrintNode printNode =new PrintNode(nodeIdGen.genId(),insertionLocation,/* isImplicit= */ true, // Implicit.  {$ij.csp_nonce} not {print $ij.csp_nonce}referenceCspNonce(insertionLocation),/* attributes= */ ImmutableList.of(),ErrorReporter.exploding())","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":194,"lineEnd":201,"lineMapIndex":18,"methodParents":[],"nodeIndex":40},{"cfgs":[42],"code":"private static VarRefNode referenceCspNonce(SourceLocation insertionLocation) ","dfgs":[42],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[],"isDel":false,"lineBeg":206,"lineEnd":206,"lineMapIndex":19,"methodParents":[],"nodeIndex":41},{"cfgs":[],"code":"return new VarRefNode(CSP_NONCE_VARIABLE_NAME,insertionLocation,/* isDollarSignIjParameter= */ true,/* defn= */ DEFN)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_ContentSecurityPolicyNonceInjectionPass.java","fieldParents":[33],"isDel":false,"lineBeg":207,"lineEnd":211,"lineMapIndex":20,"methodParents":[],"nodeIndex":42},{"cfgs":[],"code":"private final ImmutableList<TemplateParam> injectedParams","dfgs":[],"fName":"java_src_com_google_template_soy_soytree_TemplateNode.java","fieldParents":[],"isDel":false,"lineBeg":234,"lineEnd":234,"lineMapIndex":21,"methodParents":[],"nodeIndex":43},{"cfgs":[],"code":"private static final String NONCE =\"{if $ij.csp_nonce} nonce=\\\"{$ij.csp_nonce |escapeHtmlAttribute}\\\"{/if}\"","dfgs":[],"fName":"java_tests_com_google_template_soy_parsepasses_contextautoesc_ContextualAutoescaperTest.java","fieldParents":[],"isDel":false,"lineBeg":2560,"lineEnd":2561,"lineMapIndex":24,"methodParents":[],"nodeIndex":44},{"cfgs":[],"code":"addPass(new ContentSecurityPolicyNonceInjectionPass(errorReporter), singleFilePassesBuilder)","dfgs":[],"fName":"java_src_com_google_template_soy_passes_PassManager.java","fieldParents":[],"isDel":false,"lineBeg":268,"lineEnd":268,"lineMapIndex":25,"methodParents":[],"nodeIndex":45}]