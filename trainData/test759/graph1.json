[{"cfgs": [], "code": "SelectQueryOp relation = SelectQueryOp.getSelectQueryOp(Arrays.<AbstractColumn>asList(new ColumnOp(\"count\")),base)", "dfgs": [], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": true, "lineBeg": 46, "lineEnd": 48, "lineMapIndex": 25, "methodParents": [], "nodeIndex": 0, "rootcause": false, "commits": ["76400fa175aff476475bc1c20c44f7638b61da9a"]}, {"cfgs": [2], "code": "if (columnOp.getOpType().equals(\"casewhenelse\"))", "dfgs": [3, 2], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 76, "lineEnd": 76, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 1, "rootcause": false, "commits": []}, {"cfgs": [3], "code": "return \"case \" + withParentheses(columnOp.getOperand(0))+ \" when \" + withParentheses(columnOp.getOperand(1))+ \" else \" + withParentheses(columnOp.getOperand(2))+ \" end\"", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 77, "lineEnd": 80, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 2, "rootcause": false, "commits": []}, {"cfgs": [4, 5], "code": "if (columnOp.getOpType().equals(\"<>\"))", "dfgs": [5, 4], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 82, "lineEnd": 82, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 3, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return withParentheses(columnOp.getOperand(0)) + \" <> \" + withParentheses(columnOp.getOperand(1))", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 83, "lineEnd": 83, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 4, "rootcause": false, "commits": []}, {"cfgs": [6], "code": "if (columnOp.getOpType().equals(\"notnull\"))", "dfgs": [6], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 85, "lineEnd": 85, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 5, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return withParentheses(columnOp.getOperand(0)) + \" is not null\"", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_sql_RelationToSql.java", "fieldParents": [], "isDel": false, "lineBeg": 86, "lineEnd": 86, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 6, "rootcause": false, "commits": []}, {"cfgs": [8], "code": "public static ColumnOp notequal(AbstractColumn column1, AbstractColumn column2) ", "dfgs": [8], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 74, "lineEnd": 74, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 7, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return new ColumnOp(\"<>\", Arrays.asList(column1, column2))", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 75, "lineEnd": 75, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 8, "rootcause": false, "commits": []}, {"cfgs": [10], "code": "public static ColumnOp casewhenelse(AbstractColumn columnIf, AbstractColumn condition, AbstractColumn columnElse) ", "dfgs": [10], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 82, "lineEnd": 82, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 9, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return new ColumnOp(\"casewhenelse\", Arrays.asList(columnIf, condition, columnElse))", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 83, "lineEnd": 83, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 10, "rootcause": false, "commits": []}, {"cfgs": [12], "code": "public static ColumnOp notnull(AbstractColumn column1) ", "dfgs": [12], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 86, "lineEnd": 86, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 11, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return new ColumnOp(\"notnull\", Arrays.asList(column1))", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_logical_query_ColumnOp.java", "fieldParents": [], "isDel": false, "lineBeg": 87, "lineEnd": 87, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 12, "rootcause": false, "commits": []}, {"cfgs": [14], "code": "if (col.getOpType().equals(\"avg\"))", "dfgs": [14], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 89, "lineEnd": 89, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 13, "rootcause": false, "commits": []}, {"cfgs": [15], "code": "AbstractColumn op = col.getOperand()", "dfgs": [16], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 90, "lineEnd": 90, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 14, "rootcause": false, "commits": []}, {"cfgs": [16], "code": "AbstractColumn probCol = deriveInclusionProbabilityColumn(relation)", "dfgs": [19, 17, 16], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 91, "lineEnd": 91, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 15, "rootcause": false, "commits": []}, {"cfgs": [17], "code": "ColumnOp newCol1 = new ColumnOp(\"sum\",new ColumnOp(\"divide\", Arrays.asList(op, probCol)))", "dfgs": [19, 17, 18], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 93, "lineEnd": 94, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 16, "rootcause": false, "commits": []}, {"cfgs": [18], "code": "ColumnOp oneIfNotNull = ColumnOp.casewhenelse(ConstantColumn.valueOf(1),ColumnOp.notnull(op),ConstantColumn.valueOf(0))", "dfgs": [19, 18], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 96, "lineEnd": 99, "lineMapIndex": -1, "methodParents": [9], "nodeIndex": 17, "rootcause": false, "commits": []}, {"cfgs": [19], "code": "ColumnOp newCol2 = new ColumnOp(\"sum\",new ColumnOp(\"divide\", Arrays.asList(oneIfNotNull, probCol)))", "dfgs": [19, 20], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 100, "lineEnd": 101, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 18, "rootcause": false, "commits": []}, {"cfgs": [20], "code": "modifiedSelectList.add(newCol1)", "dfgs": [20], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 102, "lineEnd": 102, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 19, "rootcause": false, "commits": []}, {"cfgs": [], "code": "modifiedSelectList.add(newCol2)", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_rewriter_ScrambleRewriter.java", "fieldParents": [], "isDel": false, "lineBeg": 103, "lineEnd": 103, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 20, "rootcause": false, "commits": []}, {"cfgs": [22], "code": "public static ConstantColumn valueOf(String value) ", "dfgs": [22, 23, 24], "fName": "src_main_java_org_verdictdb_core_logical_query_ConstantColumn.java", "fieldParents": [], "isDel": false, "lineBeg": 22, "lineEnd": 22, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 21, "rootcause": false, "commits": []}, {"cfgs": [23], "code": "ConstantColumn c = new ConstantColumn()", "dfgs": [23], "fName": "src_main_java_org_verdictdb_core_logical_query_ConstantColumn.java", "fieldParents": [], "isDel": false, "lineBeg": 23, "lineEnd": 23, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 22, "rootcause": false, "commits": []}, {"cfgs": [24], "code": "c.setValue(value)", "dfgs": [24], "fName": "src_main_java_org_verdictdb_core_logical_query_ConstantColumn.java", "fieldParents": [], "isDel": false, "lineBeg": 24, "lineEnd": 24, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 23, "rootcause": false, "commits": []}, {"cfgs": [], "code": "return c", "dfgs": [], "fName": "src_main_java_org_verdictdb_core_logical_query_ConstantColumn.java", "fieldParents": [], "isDel": false, "lineBeg": 25, "lineEnd": 25, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 24, "rootcause": false, "commits": []}, {"cfgs": [], "code": "SelectQueryOp relation = SelectQueryOp.getSelectQueryOp(Arrays.<AbstractColumn>asList(new ColumnOp(\"count\")), base)", "dfgs": [], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 46, "lineEnd": 47, "lineMapIndex": 0, "methodParents": [], "nodeIndex": 25, "rootcause": false, "commits": []}, {"cfgs": [], "code": "public void testSelectAvgBaseTable() throws VerdictDbException ", "dfgs": [], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 64, "lineEnd": 64, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 26, "rootcause": false, "commits": []}, {"cfgs": [28], "code": "BaseTable base = new BaseTable(\"myschema\", \"mytable\", \"t\")", "dfgs": [28], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 65, "lineEnd": 65, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 27, "rootcause": false, "commits": []}, {"cfgs": [29], "code": "SelectQueryOp relation = SelectQueryOp.getSelectQueryOp(Arrays.<AbstractColumn>asList(new ColumnOp(\"avg\", new BaseColumn(\"t\", \"mycolumn1\"))),base)", "dfgs": [32], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 66, "lineEnd": 68, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 28, "rootcause": false, "commits": []}, {"cfgs": [30], "code": "ScrambleMeta meta = new ScrambleMeta()", "dfgs": [30], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 69, "lineEnd": 69, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 29, "rootcause": false, "commits": []}, {"cfgs": [31], "code": "meta.insertScrumbleMetaEntry(\"myschema\", \"mytable\", \"verdictpartition\", \"verdictincprob\", 10)", "dfgs": [31], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 70, "lineEnd": 70, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 30, "rootcause": false, "commits": []}, {"cfgs": [32], "code": "ScrambleRewriter rewriter = new ScrambleRewriter(meta)", "dfgs": [32], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 71, "lineEnd": 71, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 31, "rootcause": false, "commits": []}, {"cfgs": [33], "code": "List<AbstractRelation> rewritten = rewriter.rewrite(relation)", "dfgs": [36], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 72, "lineEnd": 72, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 32, "rootcause": false, "commits": []}, {"cfgs": [34], "code": "for (int k = 0; k < 10; k++)", "dfgs": [34, 36], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 74, "lineEnd": 74, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 33, "rootcause": false, "commits": []}, {"cfgs": [35], "code": "String expected = \"select sum(`t`.`mycolumn1` / `t`.`verdictincprob`), \"+ \"sum(case 1 when `t`.`mycolumn1` is not null else 0 end / `t`.`verdictincprob`) \"+ \"from `myschema`.`mytable` \"+ \"where `t`.`verdictpartition` = \" + k", "dfgs": [37], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 75, "lineEnd": 78, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 34, "rootcause": false, "commits": []}, {"cfgs": [36], "code": "RelationToSql relToSql = new RelationToSql(new HiveSyntax())", "dfgs": [36], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 79, "lineEnd": 79, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 35, "rootcause": false, "commits": []}, {"cfgs": [37], "code": "String actual = relToSql.toSql(rewritten.get(k))", "dfgs": [37], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 80, "lineEnd": 80, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 36, "rootcause": false, "commits": []}, {"cfgs": [], "code": "assertEquals(expected, actual)", "dfgs": [], "fName": "src_test_java_org_verdictdb_core_rewriter_ScrambleRewriterFlatQueryTest.java", "fieldParents": [], "isDel": false, "lineBeg": 81, "lineEnd": 81, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 37, "rootcause": false, "commits": []}]