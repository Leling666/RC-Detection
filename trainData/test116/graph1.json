[{"cfgs": [], "code": "private static final Pattern nameParser =Pattern.compile(\"([^/@]*)(/([^/@]*))?@([^/@]*)\")", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_util_KerberosName.java", "fieldParents": [], "isDel": true, "lineBeg": 56, "lineEnd": 57, "lineMapIndex": 29, "methodParents": [], "nodeIndex": 0, "rootcause": false, "commits": ["a0f120ce68dddb0cb31b64c89f3224313f3cb5af"]}, {"cfgs": [], "code": "realm = match.group(4)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_util_KerberosName.java", "fieldParents": [], "isDel": true, "lineBeg": 112, "lineEnd": 112, "lineMapIndex": 30, "methodParents": [], "nodeIndex": 1, "rootcause": false, "commits": ["a0f120ce68dddb0cb31b64c89f3224313f3cb5af"]}, {"cfgs": [], "code": "private static final Logger LOG = LoggerFactory.getLogger(KerberosAuthenticationHandler.class)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [], "isDel": true, "lineBeg": 76, "lineEnd": 77, "lineMapIndex": 31, "methodParents": [], "nodeIndex": 2, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [4, 6], "code": "if (kerbName.getHostName() != null&& kerbName.getRealm() != null&& kerbName.getServiceName() != null&& kerbName.getServiceName().equals(\"HTTP\"))", "dfgs": [4], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [], "isDel": true, "lineBeg": 276, "lineEnd": 279, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 3, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [5], "code": "LOG.trace(\"Map server: {} to principal: {}\", kerbName.getHostName(),spnegoPrincipal)", "dfgs": [6, 5], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [2], "isDel": true, "lineBeg": 280, "lineEnd": 281, "lineMapIndex": 33, "methodParents": [], "nodeIndex": 4, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [], "code": "serverPrincipalMap.put(kerbName.getHostName(), spnegoPrincipal)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [], "isDel": true, "lineBeg": 282, "lineEnd": 282, "lineMapIndex": 32, "methodParents": [], "nodeIndex": 5, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [], "code": "LOG.warn(\"HTTP principal: {} is invalid for SPNEGO!\",spnegoPrincipal)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [2], "isDel": true, "lineBeg": 284, "lineEnd": 285, "lineMapIndex": 34, "methodParents": [], "nodeIndex": 6, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [], "code": "token = Subject.doAs(serverSubject,new PrivilegedExceptionAction<AuthenticationToken>() {private Set<String> serverPrincipals =serverPrincipalMap.get(serverName);@Overridepublic AuthenticationToken run() throws Exception {if (LOG.isTraceEnabled()) {LOG.trace(\"SPNEGO with principals: {}\",serverPrincipals.toString());}AuthenticationToken token = null;Exception lastException = null;for (String serverPrincipal : serverPrincipals) {try {token = runWithPrincipal(serverPrincipal, clientToken,base64, response);} catch (Exception ex) {lastException = ex;LOG.trace(\"Auth {} failed with {}\", serverPrincipal, ex);} finally {if (token != null) {LOG.trace(\"Auth {} successfully\", serverPrincipal);break;}}}if (token != null) {return token;} else {throw new AuthenticationException(lastException);}}})", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [2], "isDel": true, "lineBeg": 415, "lineEnd": 447, "lineMapIndex": 35, "methodParents": [], "nodeIndex": 7, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f", "a0f120ce68dddb0cb31b64c89f3224313f3cb5af"]}, {"cfgs": [9], "code": "LOG.trace(\"SPNEGO initiated with principal {}\", serverPrincipal)", "dfgs": [9], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [2], "isDel": true, "lineBeg": 467, "lineEnd": 467, "lineMapIndex": 36, "methodParents": [], "nodeIndex": 8, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [], "code": "LOG.trace(\"SPNEGO completed for principal [{}]\", clientPrincipal)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [2], "isDel": true, "lineBeg": 494, "lineEnd": 494, "lineMapIndex": 37, "methodParents": [], "nodeIndex": 9, "rootcause": false, "commits": ["4c38f11cec0664b70e52f9563052dca8fb17c33f"]}, {"cfgs": [], "code": "public void testParsing() throws Exception ", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 86, "lineEnd": 86, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 10, "rootcause": false, "commits": []}, {"cfgs": [12], "code": "final String principalNameFull = \"HTTP/abc.com@EXAMPLE.COM\"", "dfgs": [14], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 87, "lineEnd": 87, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 11, "rootcause": false, "commits": []}, {"cfgs": [13], "code": "final String principalNameWoRealm = \"HTTP/abc.com\"", "dfgs": [18], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 88, "lineEnd": 88, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 12, "rootcause": false, "commits": []}, {"cfgs": [14], "code": "final String principalNameWoHost = \"HTTP@EXAMPLE.COM\"", "dfgs": [22], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 89, "lineEnd": 89, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 13, "rootcause": false, "commits": []}, {"cfgs": [15], "code": "final KerberosName kerbNameFull = new KerberosName(principalNameFull)", "dfgs": [15], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 91, "lineEnd": 91, "lineMapIndex": -1, "methodParents": [30], "nodeIndex": 14, "rootcause": false, "commits": []}, {"cfgs": [16], "code": "Assert.assertEquals(\"HTTP\", kerbNameFull.getServiceName())", "dfgs": [16], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 92, "lineEnd": 92, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 15, "rootcause": false, "commits": []}, {"cfgs": [17], "code": "Assert.assertEquals(\"abc.com\", kerbNameFull.getHostName())", "dfgs": [17], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 93, "lineEnd": 93, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 16, "rootcause": false, "commits": []}, {"cfgs": [18], "code": "Assert.assertEquals(\"EXAMPLE.COM\", kerbNameFull.getRealm())", "dfgs": [19], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 94, "lineEnd": 94, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 17, "rootcause": false, "commits": []}, {"cfgs": [19], "code": "final KerberosName kerbNamewoRealm = new KerberosName(principalNameWoRealm)", "dfgs": [19], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 96, "lineEnd": 96, "lineMapIndex": -1, "methodParents": [30], "nodeIndex": 18, "rootcause": false, "commits": []}, {"cfgs": [20], "code": "Assert.assertEquals(\"HTTP\", kerbNamewoRealm.getServiceName())", "dfgs": [20], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 97, "lineEnd": 97, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 19, "rootcause": false, "commits": []}, {"cfgs": [21], "code": "Assert.assertEquals(\"abc.com\", kerbNamewoRealm.getHostName())", "dfgs": [21], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 98, "lineEnd": 98, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 20, "rootcause": false, "commits": []}, {"cfgs": [22], "code": "Assert.assertEquals(null, kerbNamewoRealm.getRealm())", "dfgs": [23], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 99, "lineEnd": 99, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 21, "rootcause": false, "commits": []}, {"cfgs": [23], "code": "final KerberosName kerbNameWoHost = new KerberosName(principalNameWoHost)", "dfgs": [23], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 101, "lineEnd": 101, "lineMapIndex": -1, "methodParents": [30], "nodeIndex": 22, "rootcause": false, "commits": []}, {"cfgs": [24], "code": "Assert.assertEquals(\"HTTP\", kerbNameWoHost.getServiceName())", "dfgs": [24], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 102, "lineEnd": 102, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 23, "rootcause": false, "commits": []}, {"cfgs": [25], "code": "Assert.assertEquals(null, kerbNameWoHost.getHostName())", "dfgs": [25], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 103, "lineEnd": 103, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 24, "rootcause": false, "commits": []}, {"cfgs": [], "code": "Assert.assertEquals(\"EXAMPLE.COM\", kerbNameWoHost.getRealm())", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_test_java_org_apache_hadoop_security_authentication_util_TestKerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 104, "lineEnd": 104, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 25, "rootcause": false, "commits": []}, {"cfgs": [], "code": "import org.apache.hadoop.test.GenericTestUtils", "dfgs": [], "fName": "hadoop-common-project_hadoop-common_src_test_java_org_apache_hadoop_security_token_delegation_web_TestWebDelegationToken.java", "fieldParents": [], "isDel": false, "lineBeg": 34, "lineEnd": 34, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 26, "rootcause": false, "commits": []}, {"cfgs": [], "code": "import org.apache.log4j.Level", "dfgs": [], "fName": "hadoop-common-project_hadoop-common_src_test_java_org_apache_hadoop_security_token_delegation_web_TestWebDelegationToken.java", "fieldParents": [], "isDel": false, "lineBeg": 35, "lineEnd": 35, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 27, "rootcause": false, "commits": []}, {"cfgs": [], "code": "GenericTestUtils.setLogLevel(KerberosAuthenticationHandler.LOG,Level.TRACE)", "dfgs": [], "fName": "hadoop-common-project_hadoop-common_src_test_java_org_apache_hadoop_security_token_delegation_web_TestWebDelegationToken.java", "fieldParents": [], "isDel": false, "lineBeg": 202, "lineEnd": 203, "lineMapIndex": -1, "methodParents": [], "nodeIndex": 28, "rootcause": false, "commits": []}, {"cfgs": [], "code": "private static final Pattern nameParser =Pattern.compile(\"([^/@]+)(/([^/@]+))?(@([^/@]+))?\")", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_util_KerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 56, "lineEnd": 57, "lineMapIndex": 0, "methodParents": [], "nodeIndex": 29, "rootcause": false, "commits": []}, {"cfgs": [], "code": "realm = match.group(5)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_util_KerberosName.java", "fieldParents": [], "isDel": false, "lineBeg": 112, "lineEnd": 112, "lineMapIndex": 1, "methodParents": [], "nodeIndex": 30, "rootcause": false, "commits": []}, {"cfgs": [], "code": "public static final Logger LOG = LoggerFactory.getLogger(KerberosAuthenticationHandler.class)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [], "isDel": false, "lineBeg": 76, "lineEnd": 77, "lineMapIndex": 2, "methodParents": [], "nodeIndex": 31, "rootcause": false, "commits": []}, {"cfgs": [33], "code": "boolean added = serverPrincipalMap.put(kerbName.getHostName(),spnegoPrincipal)", "dfgs": [33], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [], "isDel": false, "lineBeg": 279, "lineEnd": 280, "lineMapIndex": 5, "methodParents": [], "nodeIndex": 32, "rootcause": false, "commits": []}, {"cfgs": [34], "code": "LOG.info(\"Map server: {} to principal: [{}], added = {}\",kerbName.getHostName(), spnegoPrincipal, added)", "dfgs": [34], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [31], "isDel": false, "lineBeg": 281, "lineEnd": 282, "lineMapIndex": 4, "methodParents": [], "nodeIndex": 33, "rootcause": false, "commits": []}, {"cfgs": [], "code": "LOG.warn(\"HTTP principal: [{}] is invalid for SPNEGO!\",spnegoPrincipal)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [31], "isDel": false, "lineBeg": 284, "lineEnd": 285, "lineMapIndex": 6, "methodParents": [], "nodeIndex": 34, "rootcause": false, "commits": []}, {"cfgs": [], "code": "token = Subject.doAs(serverSubject,new PrivilegedExceptionAction<AuthenticationToken>() {private Set<String> serverPrincipals =serverPrincipalMap.get(serverName);@Overridepublic AuthenticationToken run() throws Exception {if (LOG.isTraceEnabled()) {LOG.trace(\"SPNEGO with server principals: {} for {}\",serverPrincipals.toString(), serverName);}AuthenticationToken token = null;Exception lastException = null;for (String serverPrincipal : serverPrincipals) {try {token = runWithPrincipal(serverPrincipal, clientToken,base64, response);} catch (Exception ex) {lastException = ex;LOG.trace(\"Auth {} failed with {}\", serverPrincipal, ex);} finally {if (token != null) {LOG.trace(\"Auth {} successfully\", serverPrincipal);break;}}}if (token != null) {return token;} else {throw new AuthenticationException(lastException);}}})", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [31], "isDel": false, "lineBeg": 415, "lineEnd": 447, "lineMapIndex": 7, "methodParents": [], "nodeIndex": 35, "rootcause": false, "commits": []}, {"cfgs": [37], "code": "LOG.trace(\"SPNEGO initiated with server principal [{}]\", serverPrincipal)", "dfgs": [37], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [31], "isDel": false, "lineBeg": 467, "lineEnd": 467, "lineMapIndex": 8, "methodParents": [], "nodeIndex": 36, "rootcause": false, "commits": []}, {"cfgs": [], "code": "LOG.trace(\"SPNEGO completed for client principal [{}]\",clientPrincipal)", "dfgs": [], "fName": "hadoop-common-project_hadoop-auth_src_main_java_org_apache_hadoop_security_authentication_server_KerberosAuthenticationHandler.java", "fieldParents": [31], "isDel": false, "lineBeg": 494, "lineEnd": 495, "lineMapIndex": 9, "methodParents": [], "nodeIndex": 37, "rootcause": false, "commits": []}]